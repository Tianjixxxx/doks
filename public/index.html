<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>API Control Panel</title>

<style>
:root{
  --bg:#020617;
  --grid:rgba(56,189,248,.05);
  --border:#1e3a5f;
  --accent:#38bdf8;
  --text:#e5f3ff;
  --muted:#7dd3fc;
  --error:#ef4444;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:Inter,system-ui,monospace;
  background:
    linear-gradient(transparent 23px, var(--grid) 24px),
    linear-gradient(90deg, transparent 23px, var(--grid) 24px),
    var(--bg);
  background-size:24px 24px;
  color:var(--text);
}
header{
  position:fixed;
  top:0;left:0;right:0;
  height:56px;
  background:rgba(2,6,23,.85);
  border-bottom:1px solid var(--border);
  display:flex;
  align-items:center;
  padding:0 18px;
  font-weight:800;
  z-index:10;
}
main{
  max-width:1000px;
  margin:auto;
  padding:90px 16px 40px;
}
h1{text-align:center;margin-bottom:6px}
.subtitle{text-align:center;color:var(--muted);font-size:.9rem;margin-bottom:30px}

/* CATEGORY */
.category{border:1px solid var(--border);margin-bottom:14px}
.cat-header{
  padding:14px 16px;
  cursor:pointer;
  display:flex;
  justify-content:space-between;
  background:rgba(56,189,248,.05);
}
.cat-title{font-weight:800;font-size:.85rem;letter-spacing:.1em}
.cat-count{font-size:.75rem;color:var(--muted)}
.cat-body{display:none;padding:10px}

/* API CARD */
.api{border:1px dashed var(--border);padding:14px;margin-bottom:10px}
.api-name{font-weight:800}
.api-desc{font-size:.8rem;color:var(--muted);margin:4px 0}
.endpoint{
  font-family:monospace;
  font-size:.75rem;
  padding:6px 8px;
  border:1px solid var(--border);
  display:inline-block;
  margin-bottom:8px;
}
button{
  background:transparent;
  border:1px solid var(--accent);
  color:var(--accent);
  padding:6px 12px;
  font-weight:700;
  cursor:pointer;
}
button:hover{background:var(--accent);color:#001018}

/* MODAL */
.modal{
  position:fixed;
  inset:0;
  background:rgba(2,6,23,.9);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:20;
}
.modal-box{
  width:95%;
  max-width:720px;
  border:1px solid var(--accent);
  padding:16px;
  background:var(--bg);
}
.close{
  float:right;
  cursor:pointer;
  color:var(--error);
}
.response-wrapper{
  position:relative;
  margin-top:14px;
}
.copy-json{
  position:absolute;
  top:-32px;
  right:0;
  font-size:.7rem;
}
.response{
  white-space:pre-wrap;
  word-break:break-word;
  font-size:.75rem;
  border:1px solid var(--border);
  padding:12px;
  max-height:260px;
  overflow:auto;
  background:#020617;
}
</style>
</head>

<body>

<header>API SYSTEM DASHBOARD</header>

<main>
  <h1>API Control Panel</h1>
  <div class="subtitle">Blueprint-style API explorer</div>
  <div id="categories"></div>
</main>

<!-- MODAL -->
<div class="modal" id="modal">
  <div class="modal-box">
    <span class="close" onclick="closeModal()">âœ–</span>
    <h3 id="m-name"></h3>
    <div id="m-url" class="endpoint"></div>
    <div style="margin:10px 0">
      <button onclick="copyUrl()">COPY URL</button>
      <button onclick="execute()">EXECUTE</button>
    </div>

    <div class="response-wrapper">
      <button class="copy-json" onclick="copyResponse()">COPY RESPONSE</button>
      <pre class="response" id="response">// Response will appear here</pre>
    </div>
  </div>
</div>

<script>
let currentEndpoint = "";

/* LOAD APIS */
fetch("/api/list")
  .then(r=>r.json())
  .then(render);

/* RENDER */
function render(data){
  const root = document.getElementById("categories");
  Object.entries(data).forEach(([cat, apis])=>{
    const wrap = document.createElement("div");
    wrap.className = "category";
    wrap.innerHTML = `
      <div class="cat-header" onclick="toggle(this)">
        <div class="cat-title">${cat}</div>
        <div class="cat-count">${apis.length} APIs</div>
      </div>
      <div class="cat-body">
        ${apis.map(api=>`
          <div class="api">
            <div class="api-name">${api.name}</div>
            <div class="api-desc">${api.description}</div>
            <div class="endpoint">${api.method} ${api.endpoint}</div>
            <button onclick='openModal(${JSON.stringify(api)})'>TRY</button>
          </div>
        `).join("")}
      </div>
    `;
    root.appendChild(wrap);
  });
}

/* TOGGLE CATEGORY */
function toggle(el){
  const body = el.nextElementSibling;
  body.style.display = body.style.display === "block" ? "none" : "block";
}

/* MODAL */
function openModal(api){
  currentEndpoint = api.endpoint;
  document.getElementById("m-name").innerText = api.name;
  document.getElementById("m-url").innerText = location.origin + api.endpoint;
  document.getElementById("response").textContent = "// Click EXECUTE";
  document.getElementById("modal").style.display="flex";
}
function closeModal(){
  document.getElementById("modal").style.display="none";
}

/* COPY */
function copyUrl(){
  navigator.clipboard.writeText(location.origin + currentEndpoint);
}
function copyResponse(){
  navigator.clipboard.writeText(document.getElementById("response").textContent);
}

/* EXECUTE */
async function execute(){
  const resBox = document.getElementById("response");
  resBox.textContent = "Loading...";
  try{
    const r = await fetch(currentEndpoint);
    const text = await r.text();

    try{
      const json = JSON.parse(text);
      if(!json.author) json.author = "Ry";
      resBox.textContent = JSON.stringify(json, null, 2);
    }catch{
      resBox.textContent = text;
    }
  }catch(e){
    resBox.textContent = e.message;
  }
}
</script>

</body>
</html>
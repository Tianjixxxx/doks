<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>REST API Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<style>
:root{
  --bg:#0b1220;
  --panel:#0f172a;
  --border:#1e293b;
  --text:#e5e7eb;
  --accent:#2563eb;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:ui-monospace,monospace;
  background:var(--bg);
  color:var(--text);
}
header{
  padding:16px 20px;
  font-size:20px;
  background:var(--panel);
  border-bottom:1px solid var(--border);
}
.layout{
  display:flex;
  height:calc(100vh - 58px);
}
.sidebar{
  width:260px;
  background:#020617;
  border-right:1px solid var(--border);
  overflow:auto;
  padding:10px;
}
.category{
  margin-bottom:10px;
}
.category h3{
  font-size:14px;
  color:#93c5fd;
  margin:10px 0 5px;
}
.api-item{
  padding:6px 8px;
  border-radius:4px;
  cursor:pointer;
  font-size:13px;
}
.api-item:hover{
  background:#020617;
  outline:1px solid var(--border);
}
.main{
  flex:1;
  padding:20px;
  overflow:auto;
}
.card{
  background:var(--panel);
  border:1px solid var(--border);
  border-radius:6px;
  padding:16px;
  margin-bottom:15px;
}
.row{
  display:flex;
  gap:10px;
  flex-wrap:wrap;
}
button{
  background:var(--accent);
  color:white;
  border:none;
  padding:8px 12px;
  border-radius:4px;
  cursor:pointer;
}
button:hover{opacity:.9}
pre{
  background:#020617;
  border:1px solid var(--border);
  padding:12px;
  overflow:auto;
  white-space:pre-wrap;
}
.label{
  font-size:12px;
  color:#9ca3af;
}
</style>
</head>

<body>
<header>REST API Dashboard</header>

<div class="layout">
  <aside class="sidebar" id="sidebar"></aside>

  <main class="main">
    <div class="card">
      <h2 id="apiName">Select an API</h2>
      <p id="apiDesc" class="label">Choose an API from the sidebar</p>
      <p class="label">Endpoint:</p>
      <pre id="apiEndpoint">—</pre>
      <p class="label">Method:</p>
      <pre id="apiMethod">—</pre>
    </div>

    <div class="card">
      <div class="row">
        <button onclick="copyUrl()">COPY URL</button>
        <button onclick="execute()">EXECUTE</button>
        <button onclick="copyResponse()">COPY RESPONSE</button>
      </div>
    </div>

    <div class="card">
      <p class="label">Response:</p>
      <pre id="response">// response will appear here</pre>
    </div>
  </main>
</div>

<script>
let currentApi = null;
let lastResponse = "";

/* LOAD API LIST */
fetch("/__api__")
  .then(r => r.json())
  .then(data => {
    for(const category in data.categories){
      const catDiv = document.createElement("div");
      catDiv.className = "category";
      catDiv.innerHTML = `<h3>${category}</h3>`;
      
      data.categories[category].forEach(api => {
        const item = document.createElement("div");
        item.className = "api-item";
        item.textContent = api.name;
        item.onclick = () => selectApi(api);
        catDiv.appendChild(item);
      });

      sidebar.appendChild(catDiv);
    }
  });

function selectApi(api){
  currentApi = api;
  apiName.textContent = api.name;
  apiDesc.textContent = api.description;
  apiEndpoint.textContent = api.endpoint;
  apiMethod.textContent = api.method;
  response.textContent = "// click EXECUTE to test";
}

async function execute(){
  if(!currentApi) return alert("Select an API first");

  try{
    const r = await fetch(currentApi.endpoint);
    const text = await r.text();

    try{
      const json = JSON.parse(text);
      json.author = "Ry"; // ✅ ADD AUTHOR
      lastResponse = JSON.stringify(json, null, 2);
      response.textContent = lastResponse;
    }catch{
      lastResponse = text;
      response.textContent = text;
    }
  }catch(e){
    lastResponse = e.message;
    response.textContent = e.message;
  }
}

function copyUrl(){
  if(!currentApi) return;
  navigator.clipboard.writeText(location.origin + currentApi.endpoint);
}

function copyResponse(){
  navigator.clipboard.writeText(lastResponse);
}
</script>

</body>
</html>
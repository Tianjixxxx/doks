<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>API Explorer</title>

<style>
:root{
  --bg:#0f172a;
  --card:#1e293b;
  --soft:#020617;
  --accent:#3b82f6;
  --text:#e5e7eb;
  --muted:#94a3b8;
}

*{box-sizing:border-box}

body{
  margin:0;
  font-family:system-ui;
  background:var(--bg);
  color:var(--text);
}

main{
  padding:80px 16px;
  max-width:900px;
  margin:auto;
}

.api{
  background:var(--card);
  padding:14px;
  border-radius:14px;
  margin-bottom:12px;
  display:flex;
  justify-content:space-between;
  align-items:center;
}

.method{
  font-size:.75rem;
  padding:4px 8px;
  border-radius:6px;
  background:var(--accent);
  display:inline-block;
  margin-bottom:4px;
}

.btn{
  background:var(--accent);
  border:none;
  color:#fff;
  padding:8px 14px;
  border-radius:10px;
  font-weight:700;
  cursor:pointer;
}

.btn.secondary{
  background:rgba(255,255,255,.12);
}

/* MODAL */
.modal{
  position:fixed;
  inset:0;
  display:none;
  align-items:center;
  justify-content:center;
  background:rgba(0,0,0,.6);
  padding:16px;
  z-index:20;
}

.box{
  width:100%;
  max-width:760px;
  max-height:90vh;
  background:var(--card);
  border-radius:18px;
  display:flex;
  flex-direction:column;
  overflow:hidden;
}

.box-header{
  padding:18px;
  font-weight:800;
  border-bottom:1px solid rgba(255,255,255,.08);
}

.box-body{
  padding:16px;
  overflow:auto;
}

.field{
  margin-bottom:10px;
}

input{
  width:100%;
  padding:10px;
  border-radius:10px;
  border:none;
  background:rgba(255,255,255,.1);
  color:var(--text);
}

.response{
  background:var(--soft);
  border-radius:12px;
  padding:12px;
  margin-top:14px;
  height:260px;
  overflow:auto;
  font-family:monospace;
  font-size:.85rem;
  white-space:pre;
}

.actions{
  padding:14px;
  display:flex;
  gap:10px;
  border-top:1px solid rgba(255,255,255,.08);
}

.loading{
  opacity:.6;
}
</style>
</head>

<body>

<main>
  <h1>API Explorer</h1>
  <div id="app"></div>
</main>

<div id="modal" class="modal">
  <div class="box">
    <div class="box-header" id="title"></div>

    <div class="box-body">
      <div id="params"></div>
      <div class="response" id="res">Waiting for response…</div>
    </div>

    <div class="actions">
      <button class="btn" onclick="exec()">Execute</button>
      <button class="btn secondary" onclick="closeModal()">Close</button>
    </div>
  </div>
</div>

<script>
let current;

async function load(){
  const r = await fetch("/api");
  const data = await r.json();
  render(data.categories);
}

function render(categories){
  const app = document.getElementById("app");
  categories.forEach(cat=>{
    cat.apis.forEach(api=>{
      const el=document.createElement("div");
      el.className="api";
      el.innerHTML=`
        <div>
          <div class="method">${api.method}</div>
          <b>${api.name}</b>
          <div style="color:var(--muted)">${api.endpoint}</div>
        </div>
        <button class="btn">Test</button>
      `;
      el.querySelector("button").onclick=()=>open(api);
      app.appendChild(el);
    });
  });
}

function open(api){
  current=api;
  document.getElementById("modal").style.display="flex";
  document.getElementById("title").textContent=api.name;

  const p=document.getElementById("params");
  p.innerHTML="";
  (api.params||[]).forEach(x=>{
    p.innerHTML+=`
      <div class="field">
        <input id="p_${x.name}" placeholder="${x.name}" />
      </div>`;
  });

  document.getElementById("res").textContent="Waiting for response…";
}

async function exec(){
  const resBox=document.getElementById("res");
  resBox.textContent="Loading...";
  resBox.classList.add("loading");

  try{
    const q=new URLSearchParams();
    (current.params||[]).forEach(x=>{
      const v=document.getElementById("p_"+x.name).value;
      if(v) q.append(x.name,v);
    });

    const r=await fetch(
      current.endpoint+(q.toString()?"?"+q:""),
      { method: current.method }
    );

    const text=await r.text();
    let output=text;

    try{
      output=JSON.stringify(JSON.parse(text),null,2);
    }catch{}

    resBox.textContent=`Status: ${r.status}\n\n${output}`;
  }catch{
    resBox.textContent="❌ Network error";
  }

  resBox.classList.remove("loading");
}

function closeModal(){
  document.getElementById("modal").style.display="none";
}

document.getElementById("modal").onclick=e=>{
  if(e.target.id==="modal") closeModal();
};
window.addEventListener("keydown",e=>{
  if(e.key==="Escape") closeModal();
});

load();
</script>

</body>
</html>